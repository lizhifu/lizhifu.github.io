---
layout: post
title:  "系统性能观测工具"
date:   2017-02-16 21:24:19
categories: 操作系统
tags: 操作系统 linux 
---

* content
{:toc}

对于操作系统而言，提供工具去观测系统的活动状态是必不可少的部分，通过这些工具，我们可以追踪观测系统的运行状态，从而查找排除系统故障或者实现系统性能的调节优化。  

一般来说，多数的系统工具主要基于计数器和基于跟踪。同时系统性能观测工具可以按照系统级别和进程级别来分类。  





## 基于计数器  

系统内核维护了各种统计数据，称为计数器，用于对事件计数。通常计数器实现为无符号整形，发生事件时递增。如： 网络包接收计数器、磁盘I/O计数器、系统调用执行计数器。  

计数器始终由内核维护，由于其默认为开启，因此可认为“零开销”。唯一使用开销为用户空间读取的时候（可忽略不计）。  

### 系统级别  

* vmstat： 虚拟内存和物理内存的统计  
* mpstat： 每个cpu的使用情况  
* iostat： 每个磁盘I/O的使用情况，由块设备接口报告  
* netstat： 网络接口、TCP/IP栈的统计，以及每个连接的一些统计信息   
* sar： 各种各样的统计，能归档历史数据  

这些工具通常系统全体用户可见，统计出数据常用于监控软件绘图。  
这些工具的使用可选时间间隔和次数。例 ：  
![tool-1]({{"/css/pics/system/tool-1.png"}}) 


### 进程级别  

* ps： 进程状态，显示进程的各种统计信息，包括内存和CPU的使用  
* top： 按统计数据（如CPU使用）排序，显示排名高的进程  
* pmap: 将进程的内存段和使用统计一起列出  

## 跟踪  

### 系统级别  

* tcpdump： 网络包跟踪(用libcap库)  
* snoop： 为基于Solaris的系统打造的网络包跟踪工具  
* blktrace： 块I/O跟踪（Linux）  
* iosnoop： 块I/O跟踪（基于DTrace）  
* execsnoop： 跟踪新进程（基于DTrace）  
* dtruss： 系统级别的系统调用缓存跟踪（基于DTrace）  
* DTrace： 跟踪内核的内部活动和所有资源的使用情况，支持静态和动态的跟踪  
* SyStemTap： 跟踪内核的内部活动和所有资源的使用情况，支持静态和动态的跟踪  
* perf: Linux性能时间，跟踪静态和动态的探针  

### 进程级别  

* strace： 基于Linux系统的系统调用跟踪  
* truss： 基于Solaris系统的西永调用跟踪  
* gdb： 源代码级别的调试器，广泛应用于Linux系统  
* mdb： Solaris系统的一个具有可扩展性的调试器  

调试器能检查每一个时间的数据，不过做事件时需要停止目标程序的执行，然后再启动。  

Dtrace SyStemTap perf也支持对单个进行的检查。  

>                                from  《性能之巅——洞悉系统、企业与云计算》  



